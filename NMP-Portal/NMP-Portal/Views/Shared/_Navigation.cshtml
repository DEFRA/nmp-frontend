@using NMP.Portal.Resources
@using GovUk.Frontend.AspNetCore
@inject IHttpContextAccessor httpContextAccessor
@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
    var currentArea = ViewContext.RouteData.Values["area"]?.ToString();
}


@if (User.Identity?.IsAuthenticated == true)
{
    //var firstName = User.Claims.FirstOrDefault(c => c.Type == "firstName")?.Value;
   // var lastName = User.Claims.FirstOrDefault(c => c.Type == "lastName")?.Value;
    //var organisationName = User.Claims.FirstOrDefault(c => c.Type == "organisationName")?.Value;
    var currentFarmName = httpContextAccessor?.HttpContext?.Session.GetString("current_farm_name"); //User.Claims.FirstOrDefault(c => c.Type == "current_farm_name")?.Value;
    var currentFarmId = httpContextAccessor?.HttpContext?.Session.GetString("current_farm_id"); //User.Claims.FirstOrDefault(c => c.Type == "current_farm_id")?.Value;
   //var name = $"{firstName} {lastName}";
    int enrolmentCount = Convert.ToInt32(User.Claims.FirstOrDefault(c => c.Type == "enrolmentCount")?.Value);
    bool isAllFarm = (string.Equals(currentController, "Farm", StringComparison.OrdinalIgnoreCase) && string.Equals(currentAction, "FarmList", StringComparison.OrdinalIgnoreCase));
    bool isHome = string.Equals(currentController, "Home", StringComparison.OrdinalIgnoreCase);
    bool isAbout = string.Equals(currentController, "AboutService", StringComparison.OrdinalIgnoreCase);
    bool isAcceptTerms = string.Equals(currentController, "AcceptTerms", StringComparison.OrdinalIgnoreCase);
    bool isAccessibilityStatement = string.Equals(currentController, "AccessibilityStatement", StringComparison.OrdinalIgnoreCase);
    bool isAccount = string.Equals(currentController, "Account", StringComparison.OrdinalIgnoreCase);
    bool isError = string.Equals(currentController, "Error", StringComparison.OrdinalIgnoreCase);
    bool isHelpFeedback = string.Equals(currentController, "HelpAndFeedback", StringComparison.OrdinalIgnoreCase);
    bool isReleaseschedule = string.Equals(currentController, "ReleaseSchedule", StringComparison.OrdinalIgnoreCase);
    bool isFarmContext = !isAllFarm && !(
        isHome ||
        isAbout ||
        isAcceptTerms ||
        isAccessibilityStatement ||
        isAccount ||
        isError ||
        isHelpFeedback ||
        isReleaseschedule
        );
    string allFarmsActiveClass = isAllFarm ? "govuk-service-navigation__item--active" : "";
    string currentFarmActiveClass = (!isAllFarm) ? "govuk-service-navigation__item--active" : "";

    <govuk-service-navigation class="noprint" service-name="@Resource.lblPlanAndRecordNutrientApplications" service-url="/">
        <govuk-service-navigation-start>          
        </govuk-service-navigation-start>
        <govuk-service-navigation-nav>
            <govuk-service-navigation-nav-start></govuk-service-navigation-nav-start>
            <govuk-service-navigation-nav-item asp-action="FarmList" asp-controller="Farm" active="@(isAllFarm)">
                @Resource.lblAllFarm
            </govuk-service-navigation-nav-item>
            @if (isFarmContext && !string.IsNullOrWhiteSpace(currentFarmName) && !string.IsNullOrWhiteSpace(currentFarmId))
            {
                <govuk-service-navigation-nav-item asp-action="FarmSummary" asp-controller="Farm" asp-route-id="@currentFarmId" active="@(isFarmContext)">
                    @currentFarmName
                </govuk-service-navigation-nav-item>
            }
            @if (enrolmentCount > 1)
            {
                <govuk-service-navigation-nav-item asp-controller="Account" asp-action="ChangeOrganisation">
                    @Resource.lblChangeCompany
            </govuk-service-navigation-nav-item>
            }
            <govuk-service-navigation-nav-item asp-controller="Account" asp-action="Logout">
                @Resource.lblSignout
            </govuk-service-navigation-nav-item>
            <govuk-service-navigation-nav-end></govuk-service-navigation-nav-end>
        </govuk-service-navigation-nav>
        <govuk-service-navigation-end>

        </govuk-service-navigation-end>
    </govuk-service-navigation>
}